<script>
// === substitua DAQUI…
async function fetchTopFactionGlobal(){
  // Conta vitórias por facção direto no PostgREST
  const { data, error } = await supabase
    .from('game_players')
    .select('faction, wins:count()', { head: false })
    .eq('winner', true)
    .group('faction')
    .order('wins', { ascending: false })
    .limit(1);

  if (error) {
    console.error('[TopFaction] select error:', error);
    throw error;
  }
  if (!data || data.length === 0) return null;
  // data[0] = { faction: 'Letnev', wins: 12 }
  const row = data[0];
  return { faction: row.faction, wins: Number(row.wins) || 0 };
}

async function renderTopFaction(){
  const holder = document.getElementById('topFaction');
  const iconEl = document.getElementById('topFactionIcon');
  const textEl = document.getElementById('topFactionText');

  try{
    const res = await fetchTopFactionGlobal();

    // Se não houver vencedores registrados ainda, mostre uma mensagem simples
    if (!res) {
      holder.style.display = 'flex';
      iconEl.style.display = 'none';
      textEl.textContent = 'Top current winning faction: no wins yet.';
      return;
    }

    // Caminho do ícone (mantém o aliasMap/canonFactionName/factionIconPath que você já tem)
    const iconPath = factionIconPath(res.faction);

    if (iconPath) {
      iconEl.src = iconPath;      // ex.: Faction_Icons/Letnev.png
      iconEl.alt = res.faction + ' icon';
      iconEl.title = res.faction;
      iconEl.style.display = 'block';
    } else {
      iconEl.style.display = 'none';
    }

    textEl.textContent = `Top current winning faction: ${res.wins} wins.`;
    holder.style.display = 'flex';
  }catch(err){
    console.error('[TopFaction] render error:', err);
    // Não quebra a home: só esconde o bloco
    holder.style.display = 'none';
  }
}
// …ATÉ AQUI
</script>
