<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Twilight Imperium IV — Game Log</title>
  <style>
    :root {
      --bg: #0b0f14; --panel:#0f1720; --panel-2:#0c131c; --text:#e6edf3;
      --muted:#93a0ad; --border:#1e2937; --accent:#60a5fa; --ok:#10b981; --danger:#ef4444;
    }
    *{ box-sizing:border-box }
    html, body{ height:100%; margin:0; font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial; background:linear-gradient(180deg,#0a0f14 0%, #0b1016 100%); color:var(--text); }
    .container{ max-width:600px; margin:0 auto; padding:40px 20px; min-height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center; }
    .logo{ font-size:2rem; font-weight:800; margin-bottom:8px; background:linear-gradient(135deg, var(--accent), #22d3ee); -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text; }
    .subtitle{ color:var(--muted); font-size:1rem; margin-bottom:28px; line-height:1.5; }
    .card{ background:linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%); border:1px solid var(--border); border-radius:16px; padding:24px; width:100%; max-width:520px; box-shadow:0 6px 22px rgba(0,0,0,.28); }
    .btn{ background:linear-gradient(90deg, rgba(96,165,250,.18), rgba(96,165,250,.10)); border:1px solid #334155; border-radius:12px; padding:14px 20px; font-size:1rem; color:var(--text); cursor:pointer; transition:all .15s ease; width:100%; margin:10px 0; }
    .btn:hover{ background:linear-gradient(90deg, rgba(96,165,250,.25), rgba(96,165,250,.15)); border-color:#475569; transform:translateY(-1px); }
    .btn.secondary{ background:transparent; border-color:var(--border); }
    .input-group{ margin:16px 0; text-align:left; }
    .input-group label{ display:block; color:var(--muted); font-size:.9rem; margin-bottom:6px; }
    .input-group input{ width:100%; background:#0b121a; color:var(--text); border:1px solid var(--border); border-radius:12px; padding:12px; font-size:1rem; outline:none; }
    .input-group input:focus{ border-color:#334155; box-shadow:0 0 0 3px rgba(96,165,250,.18); }
    .divider{ display:flex; align-items:center; margin:20px 0; color:var(--muted); font-size:.9rem; }
    .divider::before, .divider::after{ content:''; flex:1; height:1px; background:var(--border); }
    .divider span{ padding:0 16px; }
    .loading{ display:none; color:var(--accent); font-size:.9rem; margin-top:8px; }
    .error{ color:var(--danger); font-size:.9rem; margin-top:8px; display:none; }
    .success{ color:var(--ok); font-size:.9rem; margin-top:8px; display:none; }
    footer{ margin-top:28px; color:var(--muted); font-size:12px; line-height:1.4; }
    .footer-note{ margin-top:6px; opacity:.9; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="container">
    <div class="logo">TI4 Game Log</div>
    <p class="subtitle">
      Create and share a unique log for your Twilight Imperium IV matches.
    </p>

    <div class="card">
      <!-- CREATE NEW LOG (sem campos extras) -->
      <form id="createLogForm">
        <button type="submit" class="btn" id="createBtn">Create New Game Log</button>
        <div class="loading" id="loadingMessage">Creating your personalized log…</div>
        <div class="error" id="errorMessage"></div>
        <div class="success" id="successMessage"></div>
      </form>

      <div class="divider"><span>or</span></div>

      <!-- ACCESS EXISTING LOG -->
      <form id="accessLogForm">
        <div class="input-group">
          <label for="logId">Existing Log ID (slug)</label>
          <input type="text" id="logId" placeholder="e.g., abc123xy" maxlength="20"/>
        </div>
        <button type="submit" class="btn secondary">Access Existing Log</button>
      </form>
    </div>

    <!-- Rodapé igual ao log.html -->
    <footer>
      <div>Conquer the Galaxy ⭐</div>
      <div class="footer-note">
        This project was made by someone who knows nothing about programming.<br>
        It was made for fun. It offers no support and no guarantee that your data will be saved.<br>
        Sorry.
      </div>
    </footer>
  </div>

  <script>
    // === Supabase client (usa seus valores do projeto) ===
    const SUPABASE_URL = 'https://zunnkdejwxoxgajhdwnn.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1bm5rZGVqd3hveGdhamhkd25uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzg3MjUsImV4cCI6MjA3MzgxNDcyNX0.P4tSLbtunxzWSXm0pOeZT7J35qvqiPU7Rp838z_nxVA';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // DOM
    const createForm      = document.getElementById('createLogForm');
    const accessForm      = document.getElementById('accessLogForm');
    const loadingMessage  = document.getElementById('loadingMessage');
    const errorMessage    = document.getElementById('errorMessage');
    const successMessage  = document.getElementById('successMessage');
    const createBtn       = document.getElementById('createBtn');

    function showLoading(show){ loadingMessage.style.display = show ? 'block' : 'none'; createBtn.disabled = show; }
    function showError(msg){ errorMessage.textContent = msg; errorMessage.style.display = 'block'; }
    function showSuccess(msg){ successMessage.textContent = msg; successMessage.style.display = 'block'; }
    function hideMessages(){ errorMessage.style.display = 'none'; successMessage.style.display = 'none'; }

    // CREATE new log (insere com valores padrão para colunas NOT NULL)
    createForm.addEventListener('submit', async (e)=>{
      e.preventDefault();
      showLoading(true); hideMessages();
      try{
        const { data, error } = await supabase
          .from('games')
          .insert([{ name: 'My Playgroup', creator_name: 'Anonymous' }])
          .select('slug')
          .single();
        if(error) throw error;
        showLoading(false); showSuccess('Log created! Redirecting…');
        const slug = data.slug;
        setTimeout(()=>{ window.location.href = `/log/${slug}`; }, 600);
      }catch(err){
        console.error(err); showLoading(false); showError('Error creating the log. Please try again.');
      }
    });

    // ACCESS existing log
    accessForm.addEventListener('submit', async (e)=>{
      e.preventDefault(); hideMessages();
      const slug = document.getElementById('logId').value.trim();
      if(!slug){ showError('Please enter a log ID (slug).'); return; }
      try{
        const { data, error } = await supabase
          .from('games')
          .select('slug')
          .eq('slug', slug)
          .maybeSingle();
        if(error) throw error;
        if(!data){ showError('Log not found.'); return; }
        showSuccess('Opening log…');
        setTimeout(()=>{ window.location.href = `/log/${slug}`; }, 300);
      }catch(err){
        console.error(err); showError('Error opening the log. Try again.');
      }
    });
  </script>
</body>
</html>
