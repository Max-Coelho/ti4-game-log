<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Twilight Imperium IV — Game Log</title>
<style>
:root {
      --bg: #0b0f14; --panel:#0f1720; --panel-2:#0c131c; --text:#e6edf3;
      --muted:#93a0ad; --muted-2:#7a8896; --border:#1e2937;
      --accent:#60a5fa; --accent-2:#22d3ee; --ok:#10b981; --danger:#ef4444; --warn:#f59e0b;
      --bg: #0b0f14;
      --panel: #0f1720;
      --panel-2: #0c131c;
      --text: #e6edf3;
      --muted: #93a0ad;
      --muted-2: #7a8896; /* cinza um pouco mais escuro para o rodapé */
      --border: #1e2937;
      --accent: #60a5fa;
      --accent-2: #22d3ee;
      --ok: #10b981;
      --danger: #ef4444;
      --warn: #f59e0b;
}
*{ box-sizing:border-box }
html, body{
      height:100%; margin:0;
      height:100%;
      margin:0;
font-family: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans";
background: linear-gradient(180deg, #0a0f14 0%, #0b1016 100%);
color: var(--text);
}
.container{
max-width:600px; margin:0 auto; padding:40px 20px; min-height:100vh;
display:flex; flex-direction:column; justify-content:center; align-items:center; text-align:center;
}
.logo{
font-size:2.5rem; font-weight:800; margin-bottom:8px;
background: linear-gradient(135deg, var(--accent), var(--accent-2));
-webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}
    .subtitle{ color:var(--muted); font-size:1.1rem; margin-bottom:24px; line-height:1.5; }

    /* ====== FAIXA ÚNICA DE ÍCONES (SEM DISTORCER) ====== */
    .faction-icons{
      width:100%;
      max-width:500px;           /* mesma largura do card */
      display:flex;
      flex-wrap:nowrap;          /* não quebrar linha */
      align-items:center;        /* alinha alturas ao centro */
      justify-content:center;
      gap:4px;
      margin:0 auto 24px;
    }
    .faction-icons img{
      height:16px;               /* altura fixa */
      width:auto;                /* mantém proporção */
      display:block;
      object-fit:contain;        /* segurança extra contra distorção */
      flex:0 0 auto;
      filter: drop-shadow(0 0 1px rgba(0,0,0,.35));
    }
    .subtitle{ color:var(--muted); font-size:1.1rem; margin-bottom:40px; line-height:1.5; }

.card{
background: linear-gradient(180deg, var(--panel) 0%, var(--panel-2) 100%);
border:1px solid var(--border); border-radius:16px; padding:32px;
box-shadow:0 6px 22px rgba(0,0,0,.28); width:100%; max-width:500px;
}

    /* blocos internos do card */
.block + .block{ margin-top:24px; }

.btn{
background: linear-gradient(90deg, rgba(96,165,250,.18), rgba(96,165,250,.10));
border:1px solid #334155; border-radius:12px; padding:16px 24px;
font-size:1.1rem; color:var(--text); cursor:pointer; transition:all .15s ease;
text-decoration:none; display:inline-block; width:100%; margin:12px 0;
}
.btn:hover{
background:linear-gradient(90deg, rgba(96,165,250,.25), rgba(96,165,250,.15));
border-color:#475569; transform:translateY(-1px);
}
.btn.secondary{ background:transparent; border-color:var(--border); }
    /* hover do secondary igual ao do primary */
.btn.secondary:hover{
background:linear-gradient(90deg, rgba(96,165,250,.25), rgba(96,165,250,.15));
border-color:#475569; transform:translateY(-1px);
}

.input-group{ margin:20px 0; text-align:left; }
.input-group label{ display:block; color:var(--muted); font-size:.9rem; margin-bottom:6px; }
.input-group input{
width:100%; background:#0b121a; color:var(--text); border:1px solid var(--border);
border-radius:12px; padding:12px; font-size:1rem; outline:none;
}
.input-group input:focus{ border-color:#334155; box-shadow:0 0 0 3px rgba(96,165,250,.18); }

.divider{ display:flex; align-items:center; margin:24px 0; color:var(--muted); font-size:.9rem; }
.divider::before, .divider::after{ content:''; flex:1; height:1px; background:var(--border); }
.divider span{ padding:0 16px; text-transform:uppercase; letter-spacing:.06em; font-size:.8rem; }

    /* features em 2 colunas */
.features{ list-style:none; padding:0; margin:0; text-align:left; }
.features.two-col{
display:grid; grid-template-columns: repeat(2, minmax(0, 1fr));
column-gap:20px; row-gap:8px;
}
.features li{
display:flex; align-items:center; color:var(--muted);
margin:8px 0;
}
.features li::before{
content:'✓'; color:var(--ok); font-weight:bold; margin-right:12px; font-size:1.05rem;
}
    @media (max-width:480px){
      .features.two-col{ grid-template-columns: 1fr; }
    }

    /* mensagens */
.loading{ display:none; color:var(--accent); font-size:.9rem; margin-top:12px; }
.error{ color:var(--danger); font-size:.9rem; margin-top:12px; display:none; }
.success{ color:var(--ok); font-size:.9rem; margin-top:12px; display:none; }

    /* rodapé */
.footer{
      max-width:500px; margin:32px auto 0; text-align:center;
      color:var(--muted-2); line-height:1.5; background:transparent;
      max-width:500px;
      margin:32px auto 0; /* espaçamento entre o box e o início do texto */
      text-align:center;
      color:var(--muted-2); /* cinza um pouco mais escuro */
      line-height:1.5;
      background: transparent; /* mantém o gradiente geral */
    }
    .footer-title{
      font-weight:700;
      font-size:0.95rem; /* ligeiramente maior que o texto abaixo */
      margin-bottom:4px;
    }
    .footer-text{
      font-size:0.85rem; /* um pouco menor */
      white-space:pre-line; /* mantém quebras de linha do texto fornecido */
    }

    @media (max-width:480px){
      .container{ padding:20px; }
      .logo{ font-size:2rem; }
      .card{ padding:24px; }
}
    .footer-title{ font-weight:700; font-size:0.95rem; margin-bottom:4px; }
    .footer-text{ font-size:0.85rem; white-space:pre-line; }
</style>
  <!-- Supabase JS v2 via CDN -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
<div class="container">
<div class="logo">TI4 Game Log</div>
<p class="subtitle">
Create a log for your Twilight Imperium IV matches.<br/>
Share the unique URL with your friends and track your galactic achievements together!
</p>

    <!-- LINHA ÚNICA DE ÍCONES -->
    <div class="faction-icons" aria-label="All factions">
      <img src="Faction_Icons/Arborec.png" alt="Arborec"/>
      <img src="Faction_Icons/Argent.png" alt="Argent"/>
      <img src="Faction_Icons/Creuss.png" alt="Creuss"/>
      <img src="Faction_Icons/Empyrean.png" alt="Empyrean"/>
      <img src="Faction_Icons/Hacan.png" alt="Hacan"/>
      <img src="Faction_Icons/Jol Nar.png" alt="Jol Nar"/>
      <img src="Faction_Icons/Keleres.png" alt="Council Keleres"/>
      <img src="Faction_Icons/L1Z1X.png" alt="L1Z1X"/>
      <img src="Faction_Icons/Letnev.png" alt="Barony of Letnev"/>
      <img src="Faction_Icons/Mahact.png" alt="Mahact"/>
      <img src="Faction_Icons/Mentak.png" alt="Mentak"/>
      <img src="Faction_Icons/Muaat.png" alt="Muaat"/>
      <img src="Faction_Icons/Naalu.png" alt="Naalu"/>
      <img src="Faction_Icons/Naaz-Rokha.png" alt="Naaz-Rokha"/>
      <img src="Faction_Icons/Nekro.png" alt="Nekro"/>
      <img src="Faction_Icons/Nomad.png" alt="Nomad"/>
      <img src="Faction_Icons/Saar.png" alt="Saar"/>
      <img src="Faction_Icons/Sardakk.png" alt="Sardakk N'orr"/>
      <img src="Faction_Icons/Sol.png" alt="Sol"/>
      <img src="Faction_Icons/Titans.png" alt="Titans of Ul"/>
      <img src="Faction_Icons/Vuil'Raith.png" alt="Vuil'Raith"/>
      <img src="Faction_Icons/Winnu.png" alt="Winnu"/>
      <img src="Faction_Icons/Xxcha.png" alt="Xxcha"/>
      <img src="Faction_Icons/Yin.png" alt="Yin"/>
      <img src="Faction_Icons/Yssaril.png" alt="Yssaril"/>
    </div>

<div class="card">
      <!-- BLOCO 1: ações -->
      <!-- BLOCO 1: ações (criar e acessar logs) -->
<section class="block" id="actions">
        <!-- create log: sem campos visíveis, mantém o botão e funcionalidade -->
<form id="createLogForm">
<button type="submit" class="btn" id="createBtn">
Create New Game Log
</button>
<div class="loading" id="loadingMessage">Creating your personalized log…</div>
<div class="error" id="errorMessage"></div>
<div class="success" id="successMessage"></div>
</form>

<div class="divider"><span>or</span></div>

        <!-- acesso a log existente -->
<form id="accessLogForm">
<div class="input-group">
<label for="logId">Existing Log ID (slug)</label>
<input type="text" id="logId" placeholder="e.g., abc123xy" maxlength="20"/>
</div>
<button type="submit" class="btn secondary">Access Existing Log</button>
</form>
</section>

      <!-- BLOCO 2: destaques -->
      <!-- BLOCO 2: destaques (features) -->
<section class="block" id="features">
<div class="divider"><span>features</span></div>
<ul class="features two-col">
<li>Clean interface</li>
<li>Auto stats / rankings</li>
<li>Sharable unique URL</li>
<li>Complete match history</li>
<li>TI4 + PoK + Keleres</li>
<li>Free to use</li>
</ul>
</section>
</div>

    <!-- Rodapé -->
<div class="footer" aria-label="Project disclaimer">
<div class="footer-title">Conquer the Galaxy ⭐</div>
<div class="footer-text">This project was made by a non-coder.
There is no support and your data may vanish at some point.
Sorry. = )</div>
</div>
</div>

<script>
    // === Supabase client (public URL + anon key) ===
const SUPABASE_URL = 'https://zunnkdejwxoxgajhdwnn.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inp1bm5rZGVqd3hveGdhamhkd25uIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTgyMzg3MjUsImV4cCI6MjA3MzgxNDcyNX0.P4tSLbtunxzWSXm0pOeZT7J35qvqiPU7Rp838z_nxVA';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    const createForm = document.getElementById('createLogForm');
    const accessForm = document.getElementById('accessLogForm');
    const loadingMessage = document.getElementById('loadingMessage');
    const errorMessage = document.getElementById('errorMessage');
    const successMessage = document.getElementById('successMessage');
    const createBtn = document.getElementById('createBtn');
    // DOM elements
    const createForm      = document.getElementById('createLogForm');
    const accessForm      = document.getElementById('accessLogForm');
    const loadingMessage  = document.getElementById('loadingMessage');
    const errorMessage    = document.getElementById('errorMessage');
    const successMessage  = document.getElementById('successMessage');
    const createBtn       = document.getElementById('createBtn');

    function showLoading(show){ loadingMessage.style.display = show ? 'block' : 'none'; createBtn.disabled = show; }
    function showError(msg){ errorMessage.textContent = msg; errorMessage.style.display = 'block'; }
    function showSuccess(msg){ successMessage.textContent = msg; successMessage.style.display = 'block'; }
    function hideMessages(){ errorMessage.style.display = 'none'; successMessage.style.display = 'none'; }
    // Helpers
    function showLoading(show){
      loadingMessage.style.display = show ? 'block' : 'none';
      createBtn.disabled = show;
    }
    function showError(msg){
      errorMessage.textContent = msg;
      errorMessage.style.display = 'block';
    }
    function showSuccess(msg){
      successMessage.textContent = msg;
      successMessage.style.display = 'block';
    }
    function hideMessages(){
      errorMessage.style.display = 'none';
      successMessage.style.display = 'none';
    }

    // Gera valores padrões já que removemos os campos visuais
function defaultPlaygroupName(){
      const d=new Date(), y=d.getFullYear(), m=String(d.getMonth()+1).padStart(2,'0'), day=String(d.getDate()).padStart(2,'0');
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
return `Playgroup ${y}-${m}-${day}`;
}

    // Create new game log (INSERT into public.games and get slug back)
createForm.addEventListener('submit', async (e)=>{
e.preventDefault();
      const name = defaultPlaygroupName();
      const creatorName = 'Anonymous';
      showLoading(true); hideMessages();

      const name = defaultPlaygroupName();       // valor padrão
      const creatorName = 'Anonymous';           // valor padrão

      showLoading(true);
      hideMessages();

try{
        const { data, error } = await supabase.from('games').insert([{ name, creator_name: creatorName }]).select('slug').single();
        const { data, error } = await supabase
          .from('games')
          .insert([ { name, creator_name: creatorName } ])
          .select('slug')
          .single();

if(error) throw error;
        showLoading(false); showSuccess('Log created successfully! Redirecting…');
        setTimeout(()=>{ window.location.href = `/log/${data.slug}`; }, 1200);
      }catch(err){ console.error(err); showLoading(false); showError('Error creating the log. Please try again.'); }

        showLoading(false);
        showSuccess('Log created successfully! Redirecting…');

        const slug = data.slug;
        setTimeout(()=>{ window.location.href = `/log/${slug}`; }, 1200);

      }catch(err){
        console.error(err);
        showLoading(false);
        showError('Error creating the log. Please try again.');
      }
});

    // Access existing log (SELECT by slug)
accessForm.addEventListener('submit', async (e)=>{
e.preventDefault();
const slug = document.getElementById('logId').value.trim();
      if(!slug){ showError('Please enter a log ID (slug).'); return; }
      showLoading(true); hideMessages();

      if(!slug){
        showError('Please enter a log ID (slug).');
        return;
      }

      showLoading(true);
      hideMessages();

try{
        const { data, error } = await supabase.from('games').select('slug').eq('slug', slug).maybeSingle();
        if(error) throw error; if(!data) throw new Error('Log not found');
        showLoading(false); showSuccess('Log found! Redirecting…');
        const { data, error } = await supabase
          .from('games')
          .select('slug')
          .eq('slug', slug)
          .maybeSingle();

        if(error) throw error;
        if(!data){ throw new Error('Log not found'); }

        showLoading(false);
        showSuccess('Log found! Redirecting…');
setTimeout(()=>{ window.location.href = `/log/${slug}`; }, 900);
      }catch(err){ console.error(err); showLoading(false); showError('Log not found. Please check the ID and try again.'); }

      }catch(err){
        console.error(err);
        showLoading(false);
        showError('Log not found. Please check the ID and try again.');
      }
});

    const match = window.location.pathname.match(/\/log\/([a-z0-9]{6,12})/i);
    // If URL already contains /log/<id>, reflect it on the page (cosmetic)
    const urlPath = window.location.pathname;
    const match = urlPath.match(/\/log\/([a-z0-9]{6,12})/i);
if(match){
const slug = match[1];
const subtitle = document.querySelector('.subtitle');
if (subtitle) subtitle.textContent = `Accessing log: ${slug}`;
const logIdField = document.getElementById('logId');
if (logIdField) logIdField.value = slug;
}
</script>
</body>
</html>
